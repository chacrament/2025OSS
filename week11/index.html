<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>22200100_김성찬_index.html</title>

  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 980px;
      margin: 32px auto;
      padding: 0 12px;
    }
    h1 { margin: 0 0 6px; }
    .muted { color:#666; font-size: 0.92rem; margin: 4px 0 18px; }

    table { width: 100%; border-collapse: collapse; margin-top: 16px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    thead th { background:#fafafa; }
    tr:nth-child(even){ background:#fcfcfc; }

    .btn-danger { background:#b00020; border-color:#b00020; }
  </style>
</head>
<body>
  <h1>Courses CRUD</h1>
  <p class="muted">
    API:
    <code>https://6915287984e8bd126af8d70f.mockapi.io/courses</code>
  </p>

  <button
    type="button"
    class="btn btn-primary mb-3"
    data-bs-toggle="modal"
    data-bs-target="#courseModal"
    onclick="openCreateModal()"
  >
    새 과목 추가
  </button>

  <h2 class="h4">과목 목록</h2>
  <table>
    <thead>
      <tr>
        <th style="width:70px">ID</th>
        <th>Code</th>
        <th>Title</th>
        <th>Instructor</th>
        <th style="width:90px">Credits</th>
        <th style="width:130px">Level</th>
        <th style="width:180px">Actions</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>

  <div class="modal fade" id="courseModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <form id="courseForm" autocomplete="off">
          <div class="modal-header">
            <h5 class="modal-title" id="modalTitle">새 과목 추가</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"
                    aria-label="Close"></button>
          </div>

          <div class="modal-body">
            <input type="hidden" id="id" />

            <div class="row g-3">
              <div class="col-md-4">
                <label for="code" class="form-label">Code</label>
                <input id="code" class="form-control"
                       placeholder="예: CSEE101" required />
              </div>
              <div class="col-md-8">
                <label for="title" class="form-label">Title</label>
                <input id="title" class="form-control"
                       placeholder="예: Intro to C++" required />
              </div>
              <div class="col-md-6">
                <label for="instructor" class="form-label">Instructor</label>
                <input id="instructor" class="form-control"
                       placeholder="예: Kim" required />
              </div>
              <div class="col-md-3">
                <label for="credits" class="form-label">Credits</label>
                <input id="credits" type="number" min="1" max="5"
                       class="form-control" required />
              </div>
              <div class="col-md-3">
                <label for="level" class="form-label">Level</label>
                <select id="level" class="form-select" required>
                  <option value="">선택</option>
                  <option>Beginner</option>
                  <option>Intermediate</option>
                  <option>Advanced</option>
                </select>
              </div>
            </div>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-secondary"
                    data-bs-dismiss="modal">취소</button>
            <button type="submit" class="btn btn-primary">저장</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const API_BASE = 'https://6915287984e8bd126af8d70f.mockapi.io/courses';

    const $ = (id) => document.getElementById(id);
    const tbody = $('tbody');
    const form  = $('courseForm');
    const modalEl = $('courseModal');
    const bsModal = new bootstrap.Modal(modalEl);

    async function req(url, options) {
      const res = await fetch(url, { cache: 'no-store', ...options });
      if (!res.ok) {
        const text = await res.text().catch(() => '');
        alert(`요청 실패: ${res.status} ${res.statusText}\n${text.slice(0, 200)}`);
        throw new Error(`${res.status} ${res.statusText}`);
      }
      return res;
    }

    async function list() {
      const res = await req(API_BASE);
      const rows = await res.json();

      rows.sort((a, b) => Number(a.id) - Number(b.id));

      tbody.innerHTML = rows.map(row => `
        <tr>
          <td>${row.id}</td>
          <td>${escapeHtml(row.code)}</td>
          <td>${escapeHtml(row.title)}</td>
          <td>${escapeHtml(row.instructor)}</td>
          <td>${row.credits}</td>
          <td>${escapeHtml(row.level)}</td>
          <td>
            <button
              class="btn btn-sm btn-outline-primary me-1"
              onclick="edit('${row.id}')">
              수정
            </button>
            <button
              class="btn btn-sm btn-danger"
              onclick="removeItem('${row.id}')">
              삭제
            </button>
          </td>
        </tr>
      `).join('');
    }

    function escapeHtml(s) {
      return String(s ?? '')
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
    }

    function openCreateModal() {
      clearForm();
      $('modalTitle').textContent = '새 과목 추가';
      bsModal.show();
    }

    async function edit(id) {
      const res = await req(`${API_BASE}/${encodeURIComponent(id)}`);
      const row = await res.json();

      $('id').value = row.id;
      $('code').value = row.code ?? '';
      $('title').value = row.title ?? '';
      $('instructor').value = row.instructor ?? '';
      $('credits').value = row.credits ?? '';
      $('level').value = row.level ?? '';

      $('modalTitle').textContent = `과목 수정 (ID: ${row.id})`;
      bsModal.show();
    }

    async function removeItem(id) {
      if (!confirm('정말 삭제할까요?')) return;
      await req(`${API_BASE}/${encodeURIComponent(id)}`, { method: 'DELETE' });
      await list();
    }

    function clearForm() {
      form.reset();
      $('id').value = '';
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const payload = {
        code: $('code').value.trim(),
        title: $('title').value.trim(),
        instructor: $('instructor').value.trim(),
        credits: Number($('credits').value),
        level: $('level').value
      };

      if (!payload.code || !payload.title || !payload.instructor ||
          !payload.credits || !payload.level) {
        alert('모든 항목을 입력해 주세요.');
        return;
      }

      const id = $('id').value;

      if (id) {
        await req(`${API_BASE}/${encodeURIComponent(id)}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
      } else {
        await req(API_BASE, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
      }

      bsModal.hide();
      clearForm();
      await list();
    });

    window.edit = edit;
    window.removeItem = removeItem;
    window.openCreateModal = openCreateModal;

    list();
  </script>
</body>
</html>
